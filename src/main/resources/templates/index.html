<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Weather Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>#map { height: 400px; }</style>
</head>
<body>
<h1>Weather Map</h1>

<form method="get" action="/" style="margin-bottom: 20px;">
    <input type="text" name="city" placeholder="Enter city name" th:value="${weather.city}" required />
    <button type="submit">Search</button>
</form>

<h2>Weather in <span th:text="${weather.city}">City</span></h2>
<p>Temperature: <span th:text="${weather.temperature}">--</span> Â°C</p>
<p>Lat: <span th:text="${weather.latitude}">--</span></p>
<p>Long: <span th:text="${weather.longitude}">--</span></p>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script th:inline="javascript">
    const lat = /*[[${weather.latitude} ?: 35.6895]]*/;
    const lon = /*[[${weather.longitude} ?: 139.6917]]*/;

    console.log("Initializing map with Latitude:", lat, "Longitude:", lon);

    const map = L.map('map').setView([lat, lon], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    L.marker([lat, lon]).addTo(map)
      .bindPopup("Location: " + /*[[${weather.city} ?: 'Unknown Location']]*/)
      .openPopup();
</script>
</body>
</html>
